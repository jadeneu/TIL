# 목차

# Token
토큰(Token) 기반 인증은 모던 웹서비스에서 많이 사용되고 있다. 우리가 API를 사용하는 웹서비스를 개발한다면, 토큰을 사용하여 유저들의 인증작업을 처리하는것이 가장 좋은 방법이다.

토큰 기반 인증 시스템을 선택하는데에는 여러가지 이유가 있는데, 그 중 주요 이유들은 다음과 같다.
<br><br>

## 1. Stateless 서버
Stateless 서버를 이해하려면 먼저 **Stateful** 서버가 무엇인지 알아야한다.<br>
Stateful 서버는 클라이언트에게서 요청을 받을 때 마다 클라이언트의 상태를 계속해서 유지하고, 이 정보를 서비스 제공에 이용한다.

stateful 서버의 예제로는 세션을 유지하는 웹서버가 있다.<br>
예를들어 유저가 로그인을 하면 세션에 로그인이 되었다고 저장을 해 두고, 서비스를 제공 할 때에 그 데이터를 사용하는 것이다.<br>
여기서 이 세션은 서버컴퓨터의 메모리에 담을 때도 있고, 데이터베이스 시스템에 담을 때도 있다.

**Stateless 서버는 반대로, 상태를 유지 하지 않는다.**<br>
상태 정보를 저장하지 않으면, 서버는 클라이언트측에서 들어오는 요청만으로만 작업을 처리한다.<br>
이렇게 상태가 없는 경우 클라이언트와 서버의 연결고리가 없기 때문에 서버의 확장성(Scalability)이 높아진다.
<br><br>

## 2. 모바일 어플리케이션에 적합하다
만약에 Android / iOS 모바일 어플리케이션을 개발 한다면, 안전한 API를 만들기 위해선 쿠키같은 인증시스템은 이상적이지 않다. (쿠키 컨테이너를 사용해야함)<br>
토큰 기반 인증을 도입한다면, 더욱 간단하게 이 번거로움을 해결 할 수 있다.
<br><br>

## 3. 인증정보를 다른 어플리케이션으로 전달
대표적인 예제로는, OAuth 가 있다.<br>
페이스북/구글 같은 소셜 계정들을 이용하여 다른 웹서비스에서도 로그인 하게 할 수 있다.
<br><br>

## 4. 보안
토큰 기반 인증 시스템을 사용하여 어플리케이션의 보안을 높일 수 있다.<br>
단, 이 토큰 기반 인증을 사용한다고 해서 무조건 해킹의 위험에서 벗어나는건 아니다.
<br><br><br>

# 토큰을 사용하게 된 이유
토큰 기반 인증 시스템이 어쩌다가 나타났는지 알아보자.<br>
이를 위해서는 과거의 인증시스템이 어떤 방식으로 작동했는지 살펴볼 필요가 있다.
<br><br>

## 서버 기반 인증
기존의 인증 시스템에서는 서버측에서 유저들의 정보를 기억하고 있어야한다.<br>
이 세션을 유지하기 위해서는 여러가지 방법이 사용된다.<br>
메모리 / 디스크 / 데이터베이스 시스템에 이를 담곤 한다.

서버 기반 인증 시스템의 흐름을 보자면 다음과 같다.

<img src="https://user-images.githubusercontent.com/55045377/125162029-b74a4380-e1c0-11eb-95d9-408b0cf25828.png" width=50% height=50%>

이런 방식의 인증 시스템은 아직도 많이 사용 되고 있다.<br>
하지만 요즘 웹 / 모바일 웹 어플리케이션들이 부흥하게 되면서 이런 방식의 인증 시스템은 문제를 보이기 시작했는데, 예를 들면 서버를 확장하기가 어려워진 것이다.
<br><br>

## 서버 기반 인증의 문제점
### 세션
유저가 인증을 할 때 서버는 이 기록을 서버에 저장을 해야한다. 이를 세션 이라고 부른다.<br>
대부분의 경우엔 메모리에 이를 저장하는데, 로그인 중인 유저의 수가 늘어난다면 어떻게 될까? 서버의 램이 과부화가 될 것이다.<br>
이를 피하기 위해 세션을 데이터베이스 시스템에 저장하는 방식도 있지만, 이 또한 유저의 수가 많으면 데이터베이스의 성능에 무리를 줄 수 있다.
<br><br>

### 확장성
세션을 사용하면 서버를 확장하는것이 어려워진다.<br>
여기서 서버의 확장이란, 단순히 서버의 사양을 업그레이드 하는것이 아니라 더 많은 트래픽을 감당하기 위하여 여러개의 프로세스를 돌리거나, 여러대의 서버 컴퓨터를 추가 하는것을 의미한다.<br>
세션을 사용하면서 분산된 시스템을 설계하는건 불가능한 것은 아니지만 과정이 매우 복잡해진다.
<br><br>

## CORS (Cross-Origin Resource Sharing)

<br><br><br>

# 번외. 로그인할 때 토큰이란?
블록체인 암호화폐도 토큰이라는 말을 쓴다. 그러나 여기에서 다룰 것은 블록체인 토큰이 아니고 **로그인을 하거나 사이트를 이용할 때 토큰**이다.

토큰은 말 그대로 동전이란 뜻이다. (like 버스카드나 교통카드)<br>
그런데 동전하고는 조금 다르다.<br>
동전 처럼 생겼지만 시장에 가서 물건을 사거나 할 수는 없고, 버스를 탈 때 동전 대신 넣듯이 **토큰은 특정한 목적에만 사용할 수 있다.** (돈 보다는 바우처와 비슷!)

토큰은 일종의 권리를 주는 것이다. 버스를 탈 수 있는 권리, 지하철을 탈 수 있는 권리를 부여 해주는 것이다.<br>
이 권리를 받는 방법은 토큰의 경우 돈을 냈느냐 안냈느냐 이다.<br>
돈을 내면 토큰을 받고, 이 토큰을 내서 버스에 탈 수 있다.

토큰은 이미 없어진지 오래 되었고 동전도 점점 없어지고 있어서 토큰의 의미를 직관적으로 이해하기가 어렵게 되었지만 의미 자체는 **'권리'** 이다.<br>
점점 이 토큰이라는 것이 우리 눈에 보이지 않게 클라이언트와 서버 간에 코드로 왔다갔다 하고 있는 것이 지금 기술의 발전 단계이다.
<br><br>

서버에서는 사용자가 결제한 돈도 왔다갔다 하기 때문에 '권한'이라는 것이 중요하다.<br>
인터넷에 사이트를 올리면 전 세계에서 접근 할 수 있기 때문에 사용자나 해커나 이 사이트에 접근을 할 수 있다.<br>
그래서 사용자들의 돈을 보호 하기 위해 본인만 돈을 넣거나 빼고 주문을 넣고 결제를 할 수 있게 만들어야 한다.<br>
이 토큰은 **본인 확인 수단**이다. 로그인을 할 때 id와 pw를 넣고 로그인을 하면 서버가 그것을 확인 해서 id와 pw가 맞으면 이 사용자가 유효한 사용자라는 토큰을 발행 해준다.<br>
그러면 사용자들은 이 토큰을 가지고 해당 사이트의 여러 버스에 해당하는 서비스들을 이용 할 수 있는 것이다.




























---
# 출처
* **Token [[Token](#token)]**
  + https://velopert.com/2350
* **토큰을 사용하게 된 이유 [[토큰을 사용하게 된 이유](#토큰을-사용하게-된-이유)]**
  + https://velopert.com/2350
* **번외. 로그인할 때 토큰이란? [[번외. 로그인할 때 토큰이란?](#번외-로그인할-때-토큰이란)]**
  + https://krksap.tistory.com/1586
